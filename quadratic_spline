function yint = quadratic_spline(x, f, k)
% QUADRATIC_SPLINE
% 주어진 데이터 포인트 x, f를 사용하여 목표 지점 k에 대해 2차 스플라인 보간을 수행합니다.
%
% 입력:
% x: 데이터의 x 좌표 벡터
% f: 데이터의 y 좌표 벡터 (f(x), 함숫값)
% k: 추정값(보간값)을 얻고자 하는 목표 지점 (스칼라 값)
%
% 출력:
% yint: 지점 k에서 2차 스플라인이 추정한 보간값

n = length(x);
if length(f) ~= n
    error('입력 벡터 x와 f는 길이가 같아야 합니다.');
end
if n < 3
    error('2차 스플라인을 계산하려면 최소 3개 이상의 데이터 포인트가 필요합니다.');
end

% 1. 2차 미분값 z_i (a_i 계수) 계산을 위한 선형 시스템 구성 (n-1 x n-1)
% z 벡터는 [z_1, z_2, ..., z_{n-1}] (총 n-1개)를 포함합니다.
% z_1 = 0 (자연 경계 조건)이므로, 실제 미지수는 z_2 부터 z_{n-1}까지 총 n-2개입니다.
% 따라서, 선형 시스템은 (n-2) x (n-2) 크기가 됩니다.

% h_i = x_{i+1} - x_i
h = diff(x); 

% B 벡터와 M 행렬 초기화 (M z = B 형태의 선형 시스템을 만듭니다.)
M = zeros(n-2, n-2);
B = zeros(n-2, 1);

% i는 행렬 M의 행 인덱스 (i=1은 실제 z_2를 구하는 행)
for i = 1 : n-2
    % 시스템 구성은 z_{i+1}과 z_{i+2}에 대한 관계식으로 만들어집니다.
    
    % M 행렬의 i번째 행 구성
    M(i, i) = h(i) + h(i+1); % z_{i+1}의 계수
    if i < n-2
        M(i, i+1) = h(i+1); % z_{i+2}의 계수
    end
    if i > 1
        M(i, i-1) = h(i); % z_{i}의 계수
    end

    % B 벡터의 i번째 요소 구성
    B(i) = 6 * ( (f(i+2)-f(i+1))/h(i+1) - (f(i+1)-f(i))/h(i) );
end

% 2. 2차 미분값 z_i 계산
% Z는 [z_2, z_3, ..., z_{n-1}]의 해 벡터
Z = M \ B; 

% 최종 z 벡터 ([z_1; z_2; ...; z_n])를 구성합니다.
% z_1 = 0 (자연 경계 조건: f''_1(x)=0)
% z_n = z_{n-1}을 외삽하여 추정 (혹은 다른 경계 조건 필요. 여기서는 보간에 필요한 z_i 까지만 구함)
% 실제로 보간에 필요한 z_i는 z_1, ..., z_{n-1} 입니다.

% z 벡터 구성: z_1=0, z_2=Z(1), ..., z_{n-1}=Z(n-2)
z = [0; Z]; % z_1 = 0 추가 (총 n-1개: z_1 부터 z_{n-1}까지)

% 3. 목표 지점 k가 위치한 구간 (i) 찾기
% k는 [x(i), x(i+1)] 구간에 위치해야 합니다.
i = 1;
while i < n && k >= x(i+1)
    i = i + 1;
end
if i == n
    warning('k는 데이터 범위를 벗어납니다. 외삽(Extrapolation)을 수행합니다.');
    i = n - 1; % 마지막 구간으로 설정
end

% 4. 해당 구간 i에 대한 계수 (a, b, c) 계산 및 보간값 yint 추정
% 구간 i는 [x_i, x_{i+1}] 입니다. (MATLAB 인덱스: [x(i), x(i+1)])

% a_i = z_i / (2 * h_i)
a = z(i) / (2 * h(i)); 

% b_i = (f_{i+1} - f_i) / h_i - h_i * z_i / 2
b = (f(i+1) - f(i)) / h(i) - h(i) * z(i) / 2;

% c_i = f_i
c = f(i);

% 5. 보간 다항식 P_i(k) = a_i * (k - x_i)^2 + b_i * (k - x_i) + c_i 계산
% 여기서 x_i는 x(i)입니다.
yint = a * (k - x(i))^2 + b * (k - x(i)) + c;

end
